<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Welcome to Tesla</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
:root {
  --tesla-red: #e82127;
  --tesla-dark: #111;
  --tesla-bg: #000;
  --tesla-gray: #444;
}
body {
  margin: 0;
  font-family: 'Orbitron', sans-serif;
  background-color: var(--tesla-bg);
  color: #fff;
  text-align: center;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}
.page {
  display: none;
  padding: 40px 10px;
  max-width: 600px;
  margin: auto;
}
.active {
  display: block;
  animation: fadeIn 0.6s;
}
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
button, input[type="submit"] {
  padding: 15px 30px;
  font-size: 18px;
  background-color: var(--tesla-red);
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  transition: background 0.3s;
  margin-top: 10px;
  font-family: inherit;
}
button:hover, input[type="submit"]:hover {
  background-color: #b71c1c;
}
.model-switch {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin: 20px 0;
  flex-wrap: wrap;
}
.model-switch label {
  background: var(--tesla-dark);
  padding: 15px 25px;
  border-radius: 10px;
  cursor: pointer;
  border: 2px solid var(--tesla-gray);
  transition: border 0.3s, background 0.3s;
  user-select: none;
}
input[type="radio"] {
  display: none;
}
input[type="radio"]:checked + label {
  border-color: var(--tesla-red);
  background-color: #222;
}
form input, form input:focus {
  display: block;
  margin: 10px auto;
  padding: 12px;
  width: 90%;
  max-width: 400px;
  border-radius: 5px;
  border: none;
  font-size: 16px;
  background: #222;
  color: #fff;
}
form input:focus {
  outline: 2px solid var(--tesla-red);
}
#loading {
  font-size: 20px;
  margin-top: 20px;
  color: var(--tesla-red);
}
#map {
  width: 100%;
  height: 400px;
  border: 2px solid var(--tesla-red);
  border-radius: 10px;
  margin-top: 20px;
  box-shadow: 0 6px 12px #2227;
  overflow: hidden;
  background: #111;
}
.logo {
  width: 150px;
  margin-bottom: 20px;
}
#privacy {
  font-size: 13px;
  margin-top: 30px;
  background: #222;
  color: #fff;
  padding: 18px 16px;
  border-radius: 10px;
  border: 1px solid var(--tesla-gray);
  max-width: 550px;
  margin-left: auto;
  margin-right: auto;
}
.privacy-link {
  color: var(--tesla-red);
  text-decoration: underline;
  cursor: pointer;
}
#user-summary {
  margin-top: 30px;
  background: #222;
  color: #fff;
  border-radius: 10px;
  padding: 18px 16px;
  border: 1px solid var(--tesla-gray);
  max-width: 550px;
  margin-left: auto;
  margin-right: auto;
  text-align: left;
  font-size: 16px;
}
#edit-info {
  margin-top: 20px;
  background: #444;
  color: #fff;
  border-radius: 5px;
  padding: 8px 18px;
  border: none;
  font-size: 15px;
  cursor: pointer;
  transition: background 0.3s;
}
#edit-info:hover {
  background: #e82127;
}
@media (max-width: 600px) {
  .model-switch label, button, input[type="submit"] {
    font-size: 16px;
    padding: 12px 10px;
  }
  #map {
    height: 250px;
  }
}
</style>
</head>
<body>
<!-- Welcome Page -->
<div id="welcome" class="page active" aria-labelledby="welcome-heading">
  <img src="https://upload.wikimedia.org/wikipedia/commons/e/e8/Tesla_logo.png" alt="Tesla Logo" class="logo">
  <h1 id="welcome-heading">Welcome to Tesla</h1>
  <p>Experience the future of luxury mobility</p>
  <button onclick="goTo('model')" aria-label="Begin Tesla Experience">Start</button>
  <div id="privacy">
    <strong>Privacy Notice:</strong> Your information is stored locally in your browser for a seamless user experience and is never sent to Tesla or any third party.<br>
    <span class="privacy-link" onclick="showFullPrivacy()">Learn more</span>
  </div>
</div>

<!-- Model Selection -->
<div id="model" class="page" aria-labelledby="model-heading">
  <h2 id="model-heading">Select Your Tesla Model</h2>
  <form id="modelForm" autocomplete="off">
    <div class="model-switch" role="radiogroup" aria-label="Tesla Models">
      <input type="radio" id="modelS" name="model" value="Model S" required>
      <label for="modelS" tabindex="0">Model S</label>

      <input type="radio" id="model3" name="model" value="Model 3">
      <label for="model3" tabindex="0">Model 3</label>

      <input type="radio" id="modelX" name="model" value="Model X">
      <label for="modelX" tabindex="0">Model X</label>

      <input type="radio" id="modelY" name="model" value="Model Y">
      <label for="modelY" tabindex="0">Model Y</label>
    </div>
    <button type="submit" aria-label="Proceed to Delivery Details">Next</button>
  </form>
</div>

<!-- User Info Form -->
<div id="form" class="page" aria-labelledby="form-heading">
  <h2 id="form-heading">Your Delivery Details</h2>
  <form id="userForm" autocomplete="on">
    <input type="text" name="location" placeholder="Location" required aria-label="Location" />
    <input type="text" name="firstName" placeholder="First Name" required aria-label="First Name" />
    <input type="text" name="lastName" placeholder="Last Name" required aria-label="Last Name" />
    <input type="tel" name="phone" placeholder="Phone Number" required aria-label="Phone Number" />
    <input type="email" name="email" placeholder="Email" required aria-label="Email" />
    <input type="submit" value="Submit to Management" aria-label="Submit Delivery Details" />
  </form>
  <div id="loading"></div>
</div>

<!-- Delivery Page -->
<div id="delivery" class="page" aria-labelledby="delivery-heading">
  <h2 id="delivery-heading">Delivery in Progress</h2>
  <div id="user-summary"></div>
  <p>Your Tesla is en route from Tesla HQ to your location</p>
  <div id="map" aria-label="Map showing delivery route"></div>
  <div id="delivery-status"></div>
  <button id="edit-info" style="display:none;" onclick="editUserInfo()">Edit Your Info</button>
</div>

<!-- Privacy Notice Modal -->
<div id="privacy-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.85);color:#fff;z-index:10;justify-content:center; align-items:center;">
  <div style="background:#222;padding:40px 30px;border-radius:10px;max-width:400px;box-shadow:0 6px 24px #000a;position:relative;">
    <h3>Privacy Information</h3>
    <p>
      <strong>Your privacy matters.</strong><br>
      All details you enter on this site (location, name, contact info, Tesla model selection) are stored only in your browser using local storage. This means:
      <ul style="text-align:left;">
        <li>No information is transmitted to Tesla or any third parties.</li>
        <li>Your info is used solely to personalize your experience on this device.</li>
        <li>To remove your data, use your browser's "Clear Site Data" feature or the "Edit Your Info" button.</li>
      </ul>
      For questions about privacy, contact Tesla via the official website.
    </p>
    <button onclick="closePrivacyModal()" style="margin-top:18px;">Close</button>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
function goTo(pageId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(pageId).classList.add('active');
  if(pageId === 'delivery') {
    showMap();
    showUserSummary();
    document.getElementById('edit-info').style.display = 'block';
  } else {
    document.getElementById('edit-info').style.display = 'none';
  }
}

// ---- Privacy Modal logic ----
function showFullPrivacy() {
  document.getElementById('privacy-modal').style.display = 'flex';
}
function closePrivacyModal() {
  document.getElementById('privacy-modal').style.display = 'none';
}

// ---- Saving Model Selection ----
const modelForm = document.getElementById('modelForm');
modelForm.addEventListener('submit', function(e) {
  e.preventDefault();
  const selectedModel = modelForm.querySelector('input[name="model"]:checked');
  if (selectedModel) {
    localStorage.setItem('teslaSelectedModel', selectedModel.value);
  }
  goTo('form');
});

// ---- Saving User Info ----
const userForm = document.getElementById('userForm');
const formInputs = userForm.querySelectorAll('input');
function saveUserInfo() {
  const userInfo = {};
  formInputs.forEach(input => {
    userInfo[input.name] = input.value;
  });
  localStorage.setItem('teslaUserInfo', JSON.stringify(userInfo));
}

function loadUserInfo() {
  const saved = localStorage.getItem('teslaUserInfo');
  if (saved) {
    const userInfo = JSON.parse(saved);
    formInputs.forEach(input => {
      if (userInfo[input.name]) input.value = userInfo[input.name];
    });
    return userInfo;
  }
  return null;
}

function saveSelectedModel(model) {
  localStorage.setItem('teslaSelectedModel', model);
}
function loadSelectedModel() {
  return localStorage.getItem('teslaSelectedModel');
}

// ---- Edit User Info ----
function editUserInfo() {
  goTo('form');
}

// ---- On page load, restore user info and model ----
document.addEventListener('DOMContentLoaded', () => {
  // Restore Tesla model selection
  const savedModel = loadSelectedModel();
  if (savedModel) {
    const modelRadio = modelForm.querySelector(`input[value="${savedModel}"]`);
    if (modelRadio) modelRadio.checked = true;
  }
  // Restore user info
  const info = loadUserInfo();
  if (info && info.location && info.firstName && info.lastName && info.phone && info.email) {
    goTo('delivery');
  }
});

// ---- User form submission ----
userForm.addEventListener('submit', function(e) {
  e.preventDefault();
  saveUserInfo();
  document.getElementById('loading').textContent = 'Submitting to Tesla Management...';
  setTimeout(() => {
    document.getElementById('loading').textContent = '';
    goTo('delivery');
  }, 1500);
});

// ---- Show user summary ----
function showUserSummary() {
  const info = loadUserInfo() || {};
  const model = loadSelectedModel() || '(not selected)';
  document.getElementById('user-summary').innerHTML = `
    <strong>Your Delivery Details:</strong>
    <ul style="list-style:none;padding-left:0;text-align:left;">
      <li><b>Model:</b> ${model}</li>
      <li><b>Location:</b> ${info.location || ''}</li>
      <li><b>Name:</b> ${info.firstName || ''} ${info.lastName || ''}</li>
      <li><b>Phone:</b> ${info.phone || ''}</li>
      <li><b>Email:</b> ${info.email || ''}</li>
    </ul>
  `;
}

// ---- Map logic ----
function showMap() {
  const mapDiv = document.getElementById('map');
  mapDiv.innerHTML = ""; // Clear previous map

  const teslaHQ = [37.3947, -122.1503];
  const map = L.map('map', { zoomControl: true, attributionControl: false }).setView(teslaHQ, 2);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
    minZoom: 1,
    attribution: ''
  }).addTo(map);

  L.marker(teslaHQ, { title: "Tesla HQ" }).addTo(map).bindPopup("Tesla HQ").openPopup();

  if(navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      position => {
        const userLoc = [position.coords.latitude, position.coords.longitude];
        L.marker(userLoc, { title: "Your Location", icon: L.icon({
          iconUrl: "https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-red.png",
          iconSize: [25, 41],
          iconAnchor: [12, 41],
          popupAnchor: [1, -34]
        }) }).addTo(map).bindPopup("Your Location").openPopup();
        const bounds = L.latLngBounds([teslaHQ, userLoc]);
        map.fitBounds(bounds.pad(0.3));
        L.polyline([teslaHQ, userLoc], { color: '#e82127', weight: 5, dashArray: '10 10' }).addTo(map);
        document.getElementById('delivery-status').innerHTML = `<span style="color:#e82127; font-weight:bold">Your Tesla is on the way!</span>`;
      },
      err => {
        map.setView(teslaHQ, 2);
        document.getElementById('delivery-status').innerHTML = `<span style="color:#e82127;">Unable to access your location.<br>Please enable location for better delivery experience.</span>`;
      },
      { timeout: 10000 }
    );
  } else {
    map.setView(teslaHQ, 2);
    document.getElementById('delivery-status').innerHTML = `<span style="color:#e82127;">Geolocation not supported by your browser.</span>`;
  }
}
</script>
</body>
</html>
